<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>models.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>models.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">doctest</span>

<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span><span class="p">,</span> <span class="n">login_serializer</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">flash</span>
<span class="kn">from</span> <span class="nn">flask.ext.security</span> <span class="kn">import</span> <span class="n">UserMixin</span><span class="p">,</span> <span class="n">RoleMixin</span>
<span class="kn">from</span> <span class="nn">werkzeug</span> <span class="kn">import</span> <span class="n">generate_password_hash</span><span class="p">,</span> <span class="n">check_password_hash</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">decrypt</span><span class="p">,</span> <span class="n">encrypt</span><span class="p">,</span> <span class="n">convertToHTML</span><span class="p">,</span> <span class="n">replaceImageTags</span><span class="p">,</span> <span class="n">readTempFile</span><span class="p">,</span> <span class="n">writeTempFile</span>

<span class="n">roles_users</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span> <span class="s">&#39;roles_users&#39;</span><span class="p">,</span>
        <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="s">&#39;users_id&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span> <span class="s">&#39;user.id&#39;</span> <span class="p">)</span> <span class="p">),</span>
        <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="s">&#39;roles_id&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span> <span class="s">&#39;role.id&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">users_questions</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span> <span class="s">&#39;users_questions&#39;</span><span class="p">,</span>
        <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="s">&#39;users_id&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span> <span class="s">&#39;user.id&#39;</span> <span class="p">)</span> <span class="p">),</span>
        <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="s">&#39;questions_id&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span> <span class="s">&#39;question.id&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">questions_histories</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span> <span class="s">&#39;questions_histories&#39;</span><span class="p">,</span>
        <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="s">&#39;questions_id&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span> <span class="s">&#39;question.id&#39;</span> <span class="p">)</span> <span class="p">),</span>
        <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="s">&#39;history_id&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span> <span class="s">&#39;history.id&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Role</span><span class="p">(</span> <span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">RoleMixin</span> <span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span> <span class="mi">80</span> <span class="p">),</span> <span class="n">unique</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span> <span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span> <span class="mi">255</span> <span class="p">)</span> <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&lt;Role </span><span class="si">%d</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Class that stores user information, including the password in encrypted form. Also handles session cookies</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span><span class="p">(</span> <span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">UserMixin</span> <span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>for the 'remember me' option. Also keeps track of the Role of the user (e.g. 'Admin') as well as the
   questions that the user has written. """
d = db.Column( db.Integer, primary_key = True )
mail = db.Column( db.String( 255 ), unique = True )
assword = db.Column( db.String( 255 ) )
ullname = db.Column( db.String( 255 ), index = True, unique = True )
ctive = db.Column( db.Boolean() )
reated = db.Column( db.DateTime )
 Flask-Security Fields
onfirmed_at = db.Column( db.DateTime() )
ast_login_at = db.Column( db.DateTime )
urrent_login_at = db.Column( db.DateTime )
ast_login_ip = db.Column( db.String( 100 ) )
urrent_login_ip = db.Column( db.String( 100 ) )
ogin_count = db.Column( db.Integer )
 Relationships with other models
oles = db.relationship( 'Role', secondary = roles_users, backref = db.backref( 'users', lazy = 'dynamic' ) )
uestions = db.relationship( 'Question', secondary = users_questions, backref = db.backref( 'author', lazy = 'dynamic' ) )</p>
<p>staticmethod
ef get( uid ):
   return User.query.filter_by( id = uid ).one()</p>
<p>ef get_auth_token( self ):</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Encode</span> <span class="n">a</span> <span class="n">secure</span> <span class="n">token</span> <span class="k">for</span> <span class="n">cookie</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>data = [str( self.id ), self.password]
return login_serializer.dumps( data )</p>
<p>is_authenticated( self ):
return True</p>
<p>is_active( self ):
return True</p>
<p>is_anonymous( self ):
return False</p>
<p>get_id( self ):
return unicode( self.id )</p>
<p>is_verified( self ):
return ( 'user' in self.roles or 'admin' in self.roles )</p>
<p>is_admin( self ):
return ( 'admin' in self.roles )</p>
<p>set_password( self, password ):
self.password = generate_password_hash( password )</p>
<p>check_password( self, password ):
return check_password_hash( self.password, password )</p>
<p>ticmethod
getAllAdmins():
admins = None
for user in User.query.order_by( User.id ):
    if ( user.is_admin() ):
        if admins:
            admins.append( user )
        else:
            admins = [user]
return admins</p>
<p>ticmethod
hasUnverifiedUsers():
for user in User.query.order_by( User.id ):
    if ( user.is_verified() == False ):
        return True
return False</p>
<p>ticmethod
getAllUnverifiedUsers():
unverifiedUsers = None
for user in User.query.order_by( User.id ):
    if ( user.is_verified() == False ):
        if unverifiedUsers:
            unverifiedUsers.append( user )
        else:
            unverifiedUsers = [user]
return unverifiedUsers</p>
<p><strong>repr</strong>( self ):
return '<User %d>' % self.id</p>
<p><strong>str</strong>( self ):
return 'User #%d: %s' % ( self.id, self.fullname )</p>
<p>assInfo( db.Model ):
 db.Column( db.Integer(), primary_key = True )
sAbbr = db.Column( db.String( 4 ) )
Name = db.Column( db.String( 256 ) )
tingID = db.Column( db.Integer )
entID = db.Column( db.Integer )</p>
<p>ticmethod
get( classAbbr ):
return ClassInfo.query.filter_by( classAbbr = classAbbr ).one()</p>
<p><strong>repr</strong>( self ):
return '<ClassInfo %r>' % self.id</p>
<p><strong>str</strong>( self ):
return 'ClassInfo %s (%s): startingID=%d, currentID=%d' % ( self.classAbbr, self.longName, self.startingID, self.currentID )</p>
<p>estion( db.Model ):
 db.Column( db.Integer, primary_key = True )
sID = db.Column( db.Integer )
ted = db.Column( db.DateTime )
fied = db.Column( db.DateTime )
sAbbr = db.Column( db.String( 4 ) )
 = db.Column( db.Integer )
 = db.Column( db.String( 256 ) )
IV = db.Column( db.String( 16 ) )
Comments = db.Column( db.Text )
CommentsIV = db.Column( db.String( 16 ) )
ructions = db.Column( db.Text )
ructionsIV = db.Column( db.String( 16 ) )
ructionsComments = db.Column( db.Text )
ructionsCommentsIV = db.Column( db.String( 16 ) )
tion = db.Column( db.Text )
tionIV = db.Column( db.String( 16 ) )
tionComments = db.Column( db.Text )
tionCommentsIV = db.Column( db.String( 16 ) )
ples = db.Column( db.Text )
plesIV = db.Column( db.String( 16 ) )
plesComments = db.Column( db.Text )
plesCommentsIV = db.Column( db.String( 16 ) )
s = db.Column( db.Text )
sIV = db.Column( db.String( 16 ) )
sComments = db.Column( db.Text )
sCommentsIV = db.Column( db.String( 16 ) )
er = db.Column( db.Text )
erIV = db.Column( db.String( 16 ) )
erComments = db.Column( db.Text )
erCommentsIV = db.Column( db.String( 16 ) )
_id = db.Column( db.Integer, db.ForeignKey( 'user.id' ) )
lationships with other models
ewers = db.relationship( 'User', secondary = users_questions, backref = db.backref( 'reviewers', lazy = 'dynamic' ) )
Flags = db.Column( db.Integer )
extIsEncrypted = True
tionTextIsEncrypted = True
entTextIsEncrypted = True</p>
<p>ticmethod
get( id ):
Retrieve a question from the database by raw id. Also flag the question text as being initially encrypted.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">questions</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">questions</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span> <span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span> <span class="p">(</span> <span class="n">questions</span> <span class="o">==</span> <span class="bp">None</span> <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span> <span class="n">questions</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">):</span>
            <span class="n">flash</span><span class="p">(</span> <span class="s">&quot;Couldn&#39;t find any questions in the database with (raw) ID: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">id</span> <span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">questions</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">):</span>
            <span class="n">flash</span><span class="p">(</span> <span class="s">&quot;Found more than one question (</span><span class="si">%d</span><span class="s">) in the database with (raw) ID: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">questions</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="nb">id</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">question</span> <span class="o">=</span> <span class="n">questions</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">question</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>Retrieve a question from the database by the id offset by the class id. This is to have questions numbered</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">getUsingClassID</span><span class="p">(</span> <span class="n">classID</span> <span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>within a class's category - used to generate the id to retrieve a previously generated quiz/exam.
   Also flag the question text as being initially encrypted. """
uestions = None
uestions = Question.query.filter_by( classID = classID )
f ( ( questions == None ) or ( questions.count() == 0 ) ):
   flash( "Couldn't find any questions in the database with (class) ID: %d" % classID )
   return None
f ( questions.count() &gt; 1 ):
   flash( "Found more than one question (%d) in the database with (class) ID: %d" % ( questions.count(), classID ) )
uestion = questions.one()
eturn questions.one()</p>
<p>agsAsSet( self ):
f self.tags:
   self.decryptTagText()
   result = set()
   if self.tags:
       for tag in self.tags.split( "," ):
           result.add( tag.lower().strip() )
   return result
lse:
   return "?? NO TAGS ??"</p>
<p>hortenedQuestionWithMarkup( self ):
Returned a short..ed version of the (unencrypted) question text with HTML markup</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">question</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decryptQuestionText</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">question</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">60</span> <span class="p">):</span>
                <span class="k">return</span> <span class="n">convertToHTML</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">question</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">convertToHTML</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">question</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">)</span> <span class="o">+</span> <span class="s">&quot;...&quot;</span> <span class="o">+</span> <span class="n">convertToHTML</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">question</span><span class="p">[</span><span class="o">-</span><span class="mi">28</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;?? NO QUESTION TEXT ??&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Returned a short..ed version of the (unencrypted) tags</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">shortenedDecryptedTags</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">decryptTagText</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mi">80</span> <span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">38</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;...&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="o">-</span><span class="mi">38</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;?? NO TAGS ??&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>Returns the id offset by a class's category (see getUsingClassID above)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">offsetNumberFromClass</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">classInfo</span> <span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">assert</span> <span class="p">(</span> <span class="nb">type</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">classID</span> <span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">),</span> <span class="s">&quot;self.classID (</span><span class="si">%r</span><span class="s">) != int??&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">classID</span>
        <span class="k">assert</span> <span class="p">(</span> <span class="nb">type</span><span class="p">(</span> <span class="n">classInfo</span><span class="o">.</span><span class="n">startingID</span> <span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">),</span> <span class="s">&quot;classInfo.startingID (</span><span class="si">%r</span><span class="s">) != int??&quot;</span> <span class="o">%</span> <span class="n">classInfo</span><span class="o">.</span><span class="n">startingID</span>
        <span class="n">offsetNumber</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">classID</span> <span class="o">-</span> <span class="n">classInfo</span><span class="o">.</span><span class="n">startingID</span> <span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span> <span class="nb">type</span><span class="p">(</span> <span class="n">offsetNumber</span> <span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">),</span> <span class="s">&quot;offsetNumber (</span><span class="si">%r</span><span class="s">) != int??&quot;</span> <span class="o">%</span> <span class="n">offsetNumber</span>
        <span class="k">return</span> <span class="n">offsetNumber</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Find questions "similar" to this one. Uses quiz # and tags.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">findSimilarQuestions</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>TODO: Union questions with the same tag(s) - right now it's looking for equal tags. """
xisting = []
ags = self.tagsAsSet()
nstances = Question.query.filter( Question.classAbbr == self.classAbbr, Question.id != self.id, Question.quiz == self.quiz ).order_by( Question.id ).all()
or instance in instances:
   instanceTags = instance.tagsAsSet()
   if ( len( instanceTags.intersection( tags ) ) &gt; 0 ):
       existing.append( Question.copyAndDecryptText(instance) )
eturn existing</p>
<p>ddReviewer( self, user, isOKFlag, maxReviewers ):
Add a user to a question's "reviewers" as well as set the "is this question OK" flag.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">maxReviewers</span> <span class="ow">is</span> <span class="n">necessary</span> <span class="n">to</span> <span class="n">shift</span> <span class="n">out</span> <span class="n">old</span> <span class="n">reviewers</span> <span class="ow">and</span> <span class="n">keep</span> <span class="n">the</span> <span class="n">most</span> <span class="n">recent</span> <span class="n">ones</span><span class="o">.</span> <span class="s">&quot;&quot;&quot; </span>
<span class="s">        if ( self.isOKFlags == None ):  # Initialize flags if none have been set</span>
<span class="s">            self.isOKFlags = 0</span>
<span class="s">        try:</span>
<span class="s">            userIndex = self.reviewers.index( user )</span>
<span class="s">        except ValueError as ex:</span>
<span class="s">            if ( len( self.reviewers ) == maxReviewers ):  # Shift out earliest reviewer and</span>
<span class="s">                discardedUser = self.reviewers[0]</span>
<span class="s">                self.reviewers = self.reviewers[1:]</span>
<span class="s">                print &quot;DISCARDED (overflow) REVIEWER: </span><span class="si">%s</span><span class="s">&quot; </span><span class="si">% d</span><span class="s">iscardedUser</span>
<span class="s">                self.isOKFlags = self.isOKFlags &gt;&gt; 1</span>
<span class="s">                userIndex = 2</span>
<span class="s">            else:</span>
<span class="s">                userIndex = len( self.reviewers )</span>
<span class="s">        self.isOKFlags = self.isOKFlags &amp; ~( 1 &lt;&lt; userIndex ) | isOKFlag &lt;&lt; userIndex  # Set (or clear) the corresponding isOKFlag</span>
<span class="s">        if ( userIndex &gt;= len( self.reviewers ) ):</span>
<span class="s">            self.reviewers.append( user )</span>
<span class="s">        else:</span>
<span class="s">            self.reviewers[userIndex] = user</span>
<span class="s">#DIVIDER</span>
<span class="s">    @staticmethod</span>
<span class="s">    def addMarkupToQuestionText( question, decryptTags = False, decryptQuestion = False, decryptComments = False ):</span>
<span class="s">#DIVIDER</span>
<span class="s">        convertedQuestion = copy.copy( question )</span>
<span class="s">        convertedQuestion.decryptText(decryptTags, decryptQuestion, decryptComments )</span>
<span class="s">        return convertedQuestion</span>
<span class="s">#DIVIDER</span>
<span class="s">    def decryptText( self, decryptTags = True, decryptQuestion = True, decryptComments = True ):</span>
<span class="s">#DIVIDER</span>
<span class="s">        if decryptTags:</span>
<span class="s">            self.decryptTagText()</span>
<span class="s">        if decryptQuestion:</span>
<span class="s">            self.decryptQuestionText()</span>
<span class="s">        if decryptComments:</span>
<span class="s">            self.decryptCommentText()</span>
<span class="s">#DIVIDER</span>
<span class="s">    def decryptTagText(self):</span>
<span class="s">#DIVIDER</span>
<span class="s">        if self.tagTextIsEncrypted:</span>
<span class="s">            if self.tags:</span>
<span class="s">                self.tags = decrypt( self.tags, self.tagsIV )</span>
<span class="s">            self.tagTextIsEncrypted = False</span>
<span class="s">#DIVIDER</span>
<span class="s">    def decryptQuestionText(self):</span>
<span class="s">#DIVIDER</span>
<span class="s">        if self.questionTextIsEncrypted:</span>
<span class="s">            if self.instructions:</span>
<span class="s">                self.instructions = decrypt( self.instructions, self.instructionsIV )</span>
<span class="s">            if self.question:</span>
<span class="s">                self.question = decrypt( self.question, self.questionIV )</span>
<span class="s">            if self.examples:</span>
<span class="s">                self.examples = decrypt( self.examples, self.examplesIV )</span>
<span class="s">            if self.hints:</span>
<span class="s">                self.hints = decrypt( self.hints, self.hintsIV )</span>
<span class="s">            if self.answer:</span>
<span class="s">                self.answer = decrypt( self.answer, self.answerIV )</span>
<span class="s">            self.questionTextIsEncrypted = False</span>
<span class="s">#DIVIDER</span>
<span class="s">    def decryptCommentText(self):</span>
<span class="s">#DIVIDER</span>
<span class="s">        if self.commentTextIsEncrypted:</span>
<span class="s">            if self.tagsComments:</span>
<span class="s">                self.tagsComments = decrypt( self.tagsComments, self.tagsCommentsIV )</span>
<span class="s">            if self.instructionsComments:</span>
<span class="s">                self.instructionsComments = decrypt( self.instructionsComments, self.instructionsCommentsIV )</span>
<span class="s">            if self.questionComments:</span>
<span class="s">                self.questionComments = decrypt( self.questionComments, self.questionCommentsIV )</span>
<span class="s">            if self.examplesComments:</span>
<span class="s">                self.examplesComments = decrypt( self.examplesComments, self.examplesIV )</span>
<span class="s">            if self.hintsComments:</span>
<span class="s">                self.hintsComments = decrypt( self.hintsComments, self.hintsCommentsIV )</span>
<span class="s">            if self.answerComments:</span>
<span class="s">                self.answerComments = decrypt( self.answerComments, self.answerCommentsIV )</span>
<span class="s">            self.commentTextIsEncrypted = False</span>
<span class="s">#DIVIDER</span>
<span class="s">    def encryptText( self, encryptTags = True, encryptQuestion = True, encryptComments = True ):</span>
<span class="s">#DIVIDER</span>
<span class="s">        if ((encryptTags) and (self.tagTextIsEncrypted == False)):</span>
<span class="s">            self.tags, self.tagsIV = encrypt( self.tags )</span>
<span class="s">            self.tagTextIsEncrypted = True</span>
<span class="s">        if ((encryptQuestion) and (self.questionTextIsEncrypted == False)):</span>
<span class="s">            self.instructions, self.instructionsIV = encrypt( self.instructions )</span>
<span class="s">            self.question, self.questionIV = encrypt( self.question )</span>
<span class="s">            self.examples, self.examplesIV = encrypt( self.examples )</span>
<span class="s">            self.hints, self.hintsIV = encrypt( self.hints )</span>
<span class="s">            self.answer, self.answerIV = encrypt( self.answer )</span>
<span class="s">            self.questionTextIsEncrypted = True</span>
<span class="s">        if ((encryptComments) and (self.commentTextIsEncrypted == False)):</span>
<span class="s">            self.tagsComments, self.tagsCommentsIV = encrypt( self.tagsComments )</span>
<span class="s">            self.instructionsComments, self.instructionsCommentsIV = encrypt( self.instructionsComments )</span>
<span class="s">            self.questionComments, self.questionCommentsIV = encrypt( self.questionComments )</span>
<span class="s">            self.examplesComments, self.examplesCommentsIV = encrypt( self.examplesComments )</span>
<span class="s">            self.hintsComments, self.hintsCommentsIV = encrypt( self.hintsComments )</span>
<span class="s">            self.answerComments, self.answerCommentsIV = encrypt( self.answerComments )</span>
<span class="s">            self.commentTextIsEncrypted = True</span>
<span class="s">#DIVIDER</span>

<span class="s">#DIVIDER</span>
<span class="s">    @staticmethod</span>
<span class="s">    def generateQuiz( classInfo, quizNumber, cachedQuestions, maxNumberOfQuestions ):</span>
<span class="s">#DIVIDER</span>
<span class="s">            TODO: Find questions with: most reviews, then different tags</span>
<span class="s">            TODO: Modify maxNumberOfQuestions by length of question / time to answer. &quot;&quot;&quot;</span>
        <span class="n">examQuestions</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>Add HTML markup to all of the question text, including tags and comments.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">for</span> <span class="n">question</span> <span class="ow">in</span> <span class="n">cachedQuestions</span><span class="p">:</span>
            <span class="n">markedUpQuestion</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">addMarkupToQuestionText</span><span class="p">(</span> <span class="n">Question</span><span class="o">.</span><span class="n">copyAndDecryptText</span><span class="p">(</span> <span class="n">question</span><span class="p">,</span> <span class="n">decryptComments</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">examQuestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">markedUpQuestion</span> <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">examQuestions</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="p">):</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">examQuestions</span><span class="p">,</span> <span class="n">Question</span><span class="o">.</span><span class="n">generateIDFromQuestions</span><span class="p">(</span> <span class="n">classInfo</span><span class="p">,</span> <span class="n">examQuestions</span> <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>This is mostly used for: \n -&gt; <br /> as well as replacing the <a href="image.html">image</a> tags. """
onvertedQuestion = copy.copy( question )
verallImagesToCache = set( [] )
f decryptTags:
   if convertedQuestion.tags:
       convertedQuestion.tags, imagesToCache = replaceImageTags( convertToHTML( convertedQuestion.tags ) )
       overallImagesToCache = overallImagesToCache.union( imagesToCache )
f decryptQuestion:
   if convertedQuestion.instructions:
       convertedQuestion.instructions, imagesToCache = replaceImageTags( convertToHTML( convertedQuestion.instructions ) )
       overallImagesToCache = overallImagesToCache.union( imagesToCache )
   if convertedQuestion.question:
       convertedQuestion.question, imagesToCache = replaceImageTags( convertToHTML( convertedQuestion.question ) )
       overallImagesToCache = overallImagesToCache.union( imagesToCache )
   if convertedQuestion.examples:
       convertedQuestion.examples, imagesToCache = replaceImageTags( convertToHTML( convertedQuestion.examples ) )
       overallImagesToCache = overallImagesToCache.union( imagesToCache )
   if convertedQuestion.hints:
       convertedQuestion.hints, imagesToCache = replaceImageTags( convertToHTML( convertedQuestion.hints ) )
       overallImagesToCache = overallImagesToCache.union( imagesToCache )
   if convertedQuestion.answer:
       convertedQuestion.answer, imagesToCache = replaceImageTags( convertToHTML( convertedQuestion.answer ) )
       overallImagesToCache = overallImagesToCache.union( imagesToCache )
f decryptComments:
   if convertedQuestion.instructionsComments:
       convertedQuestion.instructionsComments, imagesToCache = replaceImageTags( convertToHTML( convertedQuestion.instructionsComments ) )
       overallImagesToCache = overallImagesToCache.union( imagesToCache )
   if convertedQuestion.questionComments:
       convertedQuestion.questionComments, imagesToCache = replaceImageTags( convertToHTML( convertedQuestion.questionComments ) )
       overallImagesToCache = overallImagesToCache.union( imagesToCache )
   if convertedQuestion.examplesComments:
       convertedQuestion.examplesComments, imagesToCache = replaceImageTags( convertToHTML( convertedQuestion.examplesComments ) )
       overallImagesToCache = overallImagesToCache.union( imagesToCache )
   if convertedQuestion.hintsComments:
       convertedQuestion.hintsComments, imagesToCache = replaceImageTags( convertToHTML( convertedQuestion.hintsComments ) )
       overallImagesToCache = overallImagesToCache.union( imagesToCache )
   if convertedQuestion.answerComments:
       convertedQuestion.answerComments, imagesToCache = replaceImageTags( convertToHTML( convertedQuestion.answerComments ) )
       overallImagesToCache = overallImagesToCache.union( imagesToCache )
or filename in overallImagesToCache:
   _, _ = Image.getAndCacheByName( filename )
eturn convertedQuestion</p>
<p>ryption and decryption</p>
<p>icmethod
opyAndDecryptText( question, decryptTags = True, decryptQuestion = True, decryptComments = True ):
Decrypt all of the question text, including tags and comments.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">generateIDFromQuestions</span><span class="p">(</span> <span class="n">classInfo</span><span class="p">,</span> <span class="n">questions</span> <span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>Decrypt all of the question text, including tags and comments.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">are</span> <span class="n">offsets</span> <span class="kn">from</span> <span class="nn">the</span> <span class="nn">ClassInfo</span> <span class="nn">starting</span> <span class="nn">IDs.</span>
            <span class="n">TODO</span><span class="p">:</span> <span class="n">Turn</span> <span class="n">this</span> <span class="n">into</span> <span class="n">a</span> <span class="n">History</span> <span class="n">instead</span><span class="o">.</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        validIDSymbols = &quot;ABCDEFGHJKLMNPQRSTUVWXYZ23456789&quot;</span>
<span class="s">        numIDSymbols = len( validIDSymbols )</span>
<span class="s">        questions = []</span>
<span class="s">        questionNumbers = idSymbols.split( &#39;.&#39; )</span>
<span class="s">        if ( len( questionNumbers ) &lt; 2 ):</span>
<span class="s">            flash( &quot;ID (</span><span class="si">%s</span><span class="s">) doesn&#39;t have any question IDs??&quot; </span><span class="si">% i</span><span class="s">dSymbols, category = &quot;error&quot; )</span>
<span class="s">        else:</span>
<span class="s">            for index in range( 0, len( questionNumbers ) ):</span>
<span class="s">                if ( index == 0 ):</span>
<span class="s">                    try:</span>
<span class="s">                        classInfo = ClassInfo.get( questionNumbers[index] )</span>
<span class="s">                    except Exception as ex:</span>
<span class="s">                        flash ( &quot;idSymbol (</span><span class="si">%s</span><span class="s">) isn&#39;t a valid class abbreviation.&quot; % questionNumbers[index], category = &quot;error&quot; )</span>
<span class="s">                        break</span>
<span class="s">                else:</span>
<span class="s">                    symbol = questionNumbers[index][0]</span>
<span class="s">                    if symbol in validIDSymbols:</span>
<span class="s">                        questionNumber = validIDSymbols.find( symbol )</span>
<span class="s">                        if ( len( questionNumbers[index] ) &gt; 1 ):</span>
<span class="s">                            symbol = questionNumbers[index][1]</span>
<span class="s">                            if symbol in validIDSymbols:</span>
<span class="s">                                questionNumber = questionNumber * numIDSymbols + validIDSymbols.find( symbol )</span>
<span class="s">                            else:</span>
<span class="s">                                flash( &quot;ID &#39;</span><span class="si">%s</span><span class="s">&#39; is invalid in code: </span><span class="si">%s</span><span class="s">&quot; % ( questionNumbers[index], idSymbols ), category = &quot;warning&quot; )</span>
<span class="s">                                continue</span>
<span class="s">                    else:</span>
<span class="s">                        flash( &quot;ID &#39;</span><span class="si">%s</span><span class="s">&#39; is invalid in code: </span><span class="si">%s</span><span class="s">&quot; % ( questionNumbers[index], idSymbols ), category = &quot;warning&quot; )</span>
<span class="s">                        continue</span>
<span class="s">                    questionClassID = classInfo.startingID + questionNumber</span>
<span class="s">                    try:</span>
<span class="s">                        question = Question.getUsingClassID( questionClassID )</span>
<span class="s">                        decryptedQuestion = Question.copyAndDecryptText( question, decryptComments = False )</span>
<span class="s">                        if addMarkupToQuestionTextToo:</span>
<span class="s">                            decryptedQuestion = Question.addMarkupToQuestionText( decryptedQuestion, questionOnly = True )</span>
<span class="s">                        questions.append( decryptedQuestion )</span>
<span class="s">                    except Exception as ex:</span>
<span class="s">                        flash ( &quot;ID &#39;</span><span class="si">%s</span><span class="s">&#39; isn&#39;t a valid question [class] id (</span><span class="si">%d</span><span class="s">) for class: </span><span class="si">%s</span><span class="s"> in code: </span><span class="si">%s</span><span class="s">&quot; % ( questionNumbers[index], questionClassID, questionNumbers[index], idSymbols ), category = &quot;warning&quot; )</span>
<span class="s">                        continue</span>
<span class="s">        return questions</span>
<span class="s">#DIVIDER</span>
<span class="s">    def __repr__( self ):</span>
<span class="s">        return &#39;&lt;Question </span><span class="si">%r</span><span class="s">&gt;&#39; % ( self.id )</span>
<span class="s">#DIVIDER</span>
<span class="s">    def __str__( self ):</span>
<span class="s">        return &quot;Question #</span><span class="si">%d</span><span class="s"> (classID: </span><span class="si">%d</span><span class="s">): </span><span class="si">%s</span><span class="s">&quot; % ( self.id, self.classID, self.decryptAndShortenQuestion() )</span>
<span class="s">#DIVIDER</span>
<span class="s">class Image( db.Model ):</span>
<span class="s">#DIVIDER</span>
<span class="s">    id = db.Column( db.Integer(), primary_key = True )</span>
<span class="s">    name = db.Column( db.String( 80 ), unique = True )</span>
<span class="s">    data = db.Column( db.LargeBinary( 4096 ), unique = True )</span>
<span class="s">#DIVIDER</span>
<span class="s">    @staticmethod</span>
<span class="s">    def getByName( filename ):</span>
<span class="s">        images = None</span>
<span class="s">        images = Image.query.filter_by( name = filename )</span>
<span class="s">        if ( ( images == None ) or ( images.count() == 0 ) ):</span>
<span class="s">            flash( &quot;Couldn&#39;t find any images in the database with filename: </span><span class="si">%s</span><span class="s">&quot; </span><span class="si">% f</span><span class="s">ilename )</span>
<span class="s">            return None</span>
<span class="s">        if ( images.count() &gt; 1 ):</span>
<span class="s">            flash( &quot;Found more than one image (</span><span class="si">%d</span><span class="s">) in the database with filename: </span><span class="si">%s</span><span class="s">&quot; </span><span class="si">% f</span><span class="s">ilename )</span>
<span class="s">        return images.one()</span>

<span class="s">    @staticmethod</span>
<span class="s">    def getAndCacheByName( filename ):</span>
<span class="s">        path = None</span>
<span class="s">        try:</span>
<span class="s">            data, path = readTempFile( filename )</span>
<span class="s">        except IOError as ex:</span>
<span class="s">            data = None</span>
<span class="s">        if ( data == None ):</span>
<span class="s">            image = Image.getByName( filename )</span>
<span class="s">            if image:</span>
<span class="s">                data = image.data</span>
<span class="s">                if data:</span>
<span class="s">                    path = writeTempFile( filename, data )</span>
<span class="s">        return data, path</span>

<span class="s">    def __repr__( self ):</span>
<span class="s">        return &#39;&lt;Image </span><span class="si">%r</span><span class="s">&gt;&#39; % ( self.id )</span>

<span class="s">    def __str__( self ):</span>
<span class="s">        return &quot;Image #</span><span class="si">%d</span><span class="s"> (size=</span><span class="si">%d</span><span class="s">): </span><span class="si">%s</span><span class="s">&quot; % ( self.id, len( self.data ), self.name )</span>
<span class="s">    </span>
<span class="s">class History( db.Model ):</span>
<span class="s">#DIVIDER</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>Decrypt a question's tags (if they exist) if they aren't already decrypted.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>Decrypt a question's text parts (if they exist) if they aren't already decrypted.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Decrypt a question's comments (if they exist) if they aren't already decrypted.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>Encrypt all of the question text, including tags and comments.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>Generate Quizzes and Exams</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>Generate quiz # for a class, using previously cached questions (caller is responsible for these).</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>TODO: Find questions with: most reviews, then different tags
   TODO: Modify maxNumberOfQuestions by length of question / time to answer. """
uizQuestions = []
 questions = Question.query.filter(Question.classAbbr == session['classAbbr']).all()
or question in cachedQuestions:
   if ( question.quiz == quizNumber ):
       markedUpQuestion = Question.addMarkupToQuestionText( Question.copyAndDecryptText( question, decryptComments = False ) )
       quizQuestions.append( markedUpQuestion )
       if ( len( quizQuestions ) &gt; maxNumberOfQuestions ):
           break
eturn quizQuestions, Question.generateIDFromQuestions( classInfo, quizQuestions )</p>
<p>icmethod
enerateFinalExam( classInfo, cachedQuestions ):
Generate final exam # for a class, using previously cached questions (caller is responsible for these)</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>questions = Question.query.filter(Question.classAbbr == session['classAbbr']).all()</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>Generate an ID from quiz question ids.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>1024 questions per quiz possible. Question IDs in the database
   are offsets from the ClassInfo starting IDs. 
   TODO: Turn this into a History instead. """
alidIDSymbols = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789"
umIDSymbols = len( validIDSymbols )
dSymbols = classInfo.classAbbr
or question in questions:
   idSymbols += '.'
   qid = ( question.classID - classInfo.startingID )
   if ( qid &gt; numIDSymbols ):
       idSymbols += validIDSymbols[id / numIDSymbols]
   idSymbols += validIDSymbols[qid % numIDSymbols]
eturn idSymbols</p>
<p>icmethod
etQuestionsFromID( idSymbols, addMarkupToQuestionTextToo ):
Retrieve quiz question from an ID. Question IDs in the database</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>Class to encapsulate the storage and retrieval of images from the database.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>A general way to store previously generated data, which, for now, is a workaround for long,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>clunky IDs to retrieve previously generated quizzes and exams. Class abbreviation (e.g., 9F) and
   quiz number are to aid in retrieval and display. """
d = db.Column( db.Integer(), primary_key = True )
lassAbbr = db.Column( db.String( 4 ) )
uiz = db.Column( db.Integer ) <br />
uestions = db.relationship( 'Question', secondary = questions_histories, backref = db.backref( 'histories', lazy = 'dynamic' ) )</p>
<p>ef <strong>repr</strong>( self ):
   return '<History %r>' % ( self.id )</p>
<p>ef <strong>str</strong>( self ):
   return "History #%d: %r" % ( self.id, questions )</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
