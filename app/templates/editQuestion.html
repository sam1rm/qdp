{% extends "layout.html" %} 
{% block head %}
<style>
#_form {
    position: relative;
}
</style>
<script src="{{ url_for('static', filename='js/tinymce.min.js') }}"></script>
<script>
        tinymce.init(
        {
            selector:'textarea',
            plugins: "code image media", 
            forced_root_block : "", 
            force_br_newlines : true,
            force_p_newlines : false,
            toolbar: "code | undo redo | styleselect | pre bold italic | image",
            setup: function(ed) 
            {
                ed.on('keydown', function(evt) {
                {
                    console.debug('Key down event: ' + evt.keyCode);
                    if (evt.keyCode == 9)
                    {
                      ed.execCommand('mceInsertContent', false, '&emsp;&emsp;');
                      evt.preventDefault();
                    }
                }});
                ed.addButton('pre', 
                {
                    title: "Pre", 
                    text: "<pre>",
                    onclick : function()
                    {
                        ed.focus(); 
                        ed.formatter.toggle("pre");
                    } 
                })
            }
        });
</script>
<script>
$(document).ready(
    function() 
    {                      
        $("#tags").change( 
            function() 
            { 
                $.post(
                    $SCRIPT_ROOT+"/gatherSimilarQuestionsFromTags",
                    { tags: $("#tags").val(), questionID: {{questionToDisplay.id}}, quiz: $("#quiz").val() }
                    )
                  .done( function(data, status) {
                      $("#similar_questions").html(data);
                  }).fail( function(xhr, textStatus, errorThrown) {
                      $("#similar_questions").text(xhr.responseText);

                  });
            } 
        );
        $("#quiz").change( 
            function() 
            { 
                $.post(
                    $SCRIPT_ROOT+"/gatherSimilarQuestionsFromTags",
                    { tags: $("#tags").val(), questionID: {{questionToDisplay.id}}, quiz: $("#quiz").val() }
                    )
                  .done( function(data, status) {
                      $("#similar_questions").html(data);
                  }).fail( function(xhr, textStatus, errorThrown) {
                      $("#similar_questions").text(xhr.responseText);
                  });
            } 
        ) 
    } 
)
</script>
{% endblock %}
{% block content %} 
<table width="100%">
	<tr>
		<td width="50%">
			<form method="post" action="saveQuestion?questionID={{questionToDisplay.id}}" class="well span6" id="_form">
				{{form.hidden_tag()}} 
				<div class="control-group">
					<label class="control-label" for="quiz">
						Quiz: 
					</label>
					{{form.quiz}}
				</div>
				<div class="upright1 text-muted">DATABASE ID #{{questionToDisplay.id}}</div>
			<div class="span6">
					<label class="control-label" for="tags">
						Tags: 
					</label>
					{{form.tags(rows=1,cols=100)}} <small>(comma separated)</small>
				</div>
				<div class="control-group">
					<label class="control-label" for="instructions">
						Instructions: 
					</label>
					{{form.instructions(rows=rowCountsToDisplay['instructions'],cols=100)}} 
				</div>
				<div class="control-group">
					<label class="control-label" for="question">
						Question: 
					</label>
					{{form.question(rows=rowCountsToDisplay['question'],cols=100)}} 
				</div>
				<div class="control-group">
					<label class="control-label" for="examples">
						Examples: 
					</label>
					{{form.examples(rows=rowCountsToDisplay['examples'],cols=100)}} 
				</div>
				<div class="control-group">
					<label class="control-label" for="hints">
						Hints/Cautions/etc.: 
					</label>
					{{form.hints(rows=rowCountsToDisplay['hints'],cols=100)}} 
				</div>
                <div class="control-group">
                    <label class="control-label" for="answer">
                        Answer: 
                    </label>
                    {{form.answer(rows=rowCountsToDisplay['answer'],cols=100)}} 
                </div>
                <table table-striped table-hover>
                    {% for reviewer in questionToDisplay.reviewers %}
                        <tr>
                            <td><label class="control-label" for="reviewed1">Reviewed by:&nbsp;</label>{{reviewer.fullname}}</td>
                            <td>&lt;{{reviewer.email}}&gt;</td>
                            <td>&nbsp;
                                {% if reviewersSaidOKToDisplay[loop.index] %}
                                 <span class="glyphicon glyphicon-ok"> </span> 
                                {% else %}
                                 <span class="glyphicon glyphicon-thumbs-down"> </span> 
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
				</table>
				<br> <br />
 				<div class="control-group">
                    <button type="submit" class="btn btn-primary center" name='button' value="done">
                        Save 
                    </button>
                    <button type="submit" class="btn btn-danger center" name='button' value="delete">
                        Delete 
                    </button>
				</div>
			</form>
		</td>
		<td style="vertical-align:top;" td width="50%">
			<h3>
				Similar Questions 
			</h3>
			<div class="tabbable" id="similar_questions">
            </div>
		</td>
	</tr>
</table>
{% endblock %}